<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Agricultural Advisory System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{ --red:#e74c3c; --green:#2e8b57; --green-dark:#246b45;}
body{ font-family:'Poppins',sans-serif; margin:0; padding:0; background:rgba(200,255,200,0.25); background-image:url('background.jpg'); background-size:cover; background-position:center;}
header{text-align:center; background:var(--green); color:#fff; padding:18px 10px; font-size:26px; font-weight:700; position:relative;}
.mic-inline{ cursor:pointer; font-size:22px; background:none; border:2px dashed rgba(0,0,0,0.05); padding:8px 12px; border-radius:10px; display:inline-flex; align-items:center; gap:8px; transition:0.2s;}
.mic-inline.live{ background:yellow; color:#000; animation:micPulse 1.5s infinite;}
@keyframes micPulse {
  0% { box-shadow:0 0 0 0 rgba(255,255,0,0.7);}
  70% { box-shadow:0 0 0 20px rgba(255,255,0,0);}
  100% { box-shadow:0 0 0 0 rgba(255,255,0,0);}
}
.container{ max-width:700px; margin:28px auto; background:#ffffffe6; padding:22px; border-radius:14px; box-shadow:0 6px 30px rgba(0,0,0,0.15);}
.profile{ display:flex; justify-content:flex-end; align-items:center; gap:14px;}
.profile img{ width:150px; height:150px; border-radius:50%; object-fit:cover; border:4px solid var(--red);}
.profile .subtitle{text-align:center; font-size:13px; color:#333; line-height:1.1; white-space:pre-line;}
form .row{ display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap; }
.left, .right { flex:1 1 320px; min-width:280px; }
label{ display:block; margin-top:8px; font-weight:600; color:#222; }
input, select, button { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #ccc; font-size:15px; }
button{ background:var(--red); color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px;}
button:hover{ background:#c0392b; }
button.vertical{ flex-direction:column; padding:12px; font-size:16px; }
#adviceResult{ margin-top:16px; padding:15px; border-radius:10px; background: rgba(255,0,0,0.05); font-weight:600; color:#0b3; white-space:pre-line; }
canvas{ margin-top:20px; width:100% !important; height:400px !important; }
.crop-thumbs{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.thumb{ width:90px; height:70px; border-radius:8px; overflow:hidden; border:2px solid transparent; cursor:pointer; text-align:center; display:flex; align-items:center; justify-content:center; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
.thumb.selected{ border-color:var(--red); box-shadow:0 4px 14px rgba(231,76,60,0.3); }
.lang-area{ text-align:center; margin-top:8px; }
.meta-small{ font-size:13px; color:#555; margin-top:6px; }
@media (max-width:720px){ .left, .right { min-width:100%; } .crop-thumbs{ justify-content:flex-start; } }
.fade-in{ animation:fadeIn 0.8s ease-in-out;}
@keyframes fadeIn{ from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
#forecastChart{ height:260px !important; }
</style>
</head>
<body>
<header id="siteHeader">
  Agricultural Advisory System
  <div class="lang-area" style="margin-top:8px;">
    <button id="langToggle">üåê change Language / Badilisha Lugha</button>
  </div>
</header>

<div class="container">
  <div class="profile">
    <div><img id="profileImg" src="profile.jpg" alt="Profile"></div>
    <div class="subtitle">
Created by
Name:Taisoni Ambokile Mwaluswaswa
Phone No:0749458547
Proffessionalism:GIS and RS Expert
Gmail:taisonimwuluswaswa@gmail.com
    </div>
  </div>

  <form id="mainForm" onsubmit="return false;">
    <div class="row">
      <div class="left">
        <div style="display:flex; gap:10px; align-items:center; justify-content:flex-start; margin-bottom:8px;">
          <button id="globalMic" type="button" class="mic-inline" title="Start Speaking">üé§ <span id="micLabel">Start Speaking</span></button>
        </div>

        <label id="lblName">Full Name:</label>
        <input id="farmerName" type="text" placeholder="Enter your name" />
        <label id="lblGender">Gender:</label>
        <select id="gender">
          <option value="">Select Gender</option>
          <option value="male">üßëüèæ‚Äç Male</option>
          <option value="female">üßïüèæ Female</option>
        </select>
        <label id="lblRegion">Region:</label>
        <select id="region"></select>
        <label id="lblCrop">Crop:</label>
        <select id="cropSelect"></select>
        <div class="crop-thumbs" id="cropThumbs"></div>
        <div class="meta-small">Tip: you may click thumbnail to choose crop.</div>
        <label id="lblChartType">Chart Type:</label>
        <select id="chartType">
          <option value="line">Line (monthly)</option>
          <option value="bar">Bar</option>
        </select>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:12px;">
          <button type="button" class="vertical" onclick="showTrend()">üìä Show TrendüòÅ</button>
          <button type="button" class="vertical" onclick="showAdvice()">üí¨ Show Advice</button>
          <button type="button" class="vertical" onclick="checkWeather()">üå¶Ô∏è Check Weather</button>
        </div>
        <div id="adviceResult" aria-live="polite"></div>
      </div>

      <div class="right">
        <canvas id="trendChart"></canvas>
        <canvas id="forecastChart"></canvas>
      </div>
    </div>
  </form>
</div>

<script>
const apiKey="4970f8ff4bc343c5721c08b2e682f022";
let currentLang='en'; let chartInstance=null; let forecastInstance=null;
const startYear=2016,endYear=2025,monthsNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const regionsAPI=[{name:"Songwe",lat:-9.258,lng:33.642},{name:"Mbeya",lat:-8.91,lng:33.45},{name:"Iringa",lat:-7.771,lng:35.685},{name:"Dodoma",lat:-6.163,lng:35.751},{name:"Morogoro",lat:-6.827,lng:37.659},{name:"Kilimanjaro",lat:-3.067,lng:37.355},{name:"Mwanza",lat:-2.516,lng:32.9},{name:"Arusha",lat:-3.386,lng:36.68},{name:"Tanga",lat:-5.07,lng:39.1},{name:"Ruvuma",lat:-10.634,lng:35.616},{name:"Dar es Salaam",lat:-6.7924,lng:39.2083},{name:"Tunduma",lat:-9.3,lng:32.8}];
const cropsEN=["Corn","Rice","Tea","Coffee","Beans","Potatoes","Cassava"],cropsSW=["Mahindi","Mpunga","Chai","Kahawa","Maharage","Viazi","Ufuta"];
const cropImages={Mahindi:"mahindi.jpg",Mpunga:"mpunga.jpg",Chai:"chai.jpg",Kahawa:"kahawa.jpg",Maharage:"maharage.jpg",Viazi:"viazi.jpg",Ufuta:"ufuta.jpg"};
function buildMonthlyLabels(){const labels=[];for(let y=startYear;y<=endYear;y++){for(let m=0;m<12;m++){labels.push(`${y} ${monthsNames[m]}`);}}return labels;}
const monthlyLabels=buildMonthlyLabels();const cropData={};
cropsSW.forEach(c=>{const rainfall=[],temperature=[],ndvi=[];for(let i=0;i<monthlyLabels.length;i++){const m=i%12;let baseRain=100,baseTemp=22,baseNDVI=0.5;switch(c){case"Mahindi":baseRain=90;baseTemp=22;baseNDVI=0.45;break;case"Mpunga":baseRain=160;baseTemp=27;baseNDVI=0.6;break;case"Chai":baseRain=140;baseTemp=19;baseNDVI=0.7;break;case"Kahawa":baseRain=130;baseTemp=21;baseNDVI=0.6;break;case"Maharage":baseRain=110;baseTemp=24;baseNDVI=0.5;break;case"Ufuta":baseRain=85;baseTemp=23;baseNDVI=0.44;break;}
const s=1+0.5*Math.sin((m/12)*2*Math.PI+(c.length%3));rainfall.push(Math.round(baseRain*s+Math.random()*40-20));temperature.push(+(baseTemp+Math.cos((m/12)*2*Math.PI)*2+Math.random()*4-2).toFixed(1));ndvi.push(+(baseNDVI+Math.sin((m/12)*2*Math.PI)*0.05+Math.random()*0.16-0.08).toFixed(2));}
let req="";switch(c){case"Mahindi":req="Needs 500‚Äì800mm rainfall and 18‚Äì27¬∞C.";break;case"Mpunga":req="Needs 1000‚Äì2000mm rainfall and >25¬∞C.";break;case"Chai":req="Prefers 1200‚Äì2500mm rainfall and 16‚Äì25¬∞C.";break;case"Kahawa":req="Needs 1000‚Äì2000mm rainfall and 18‚Äì26¬∞C.";break;case"Maharage":req="Moderate 600‚Äì1200mm and 18‚Äì28¬∞C.";break;case"Ufuta":req="Needs 600‚Äì900mm and 18‚Äì26¬∞C.";break;}
cropData[c]={rainfall,temperature,ndvi,requirements:req};});
function populateCrops(){const cropSelect=document.getElementById('cropSelect');const thumbs=document.getElementById('cropThumbs');cropSelect.innerHTML="";thumbs.innerHTML="";const list=currentLang==='en'?cropsEN:cropsSW;list.forEach((c,i)=>{const o=document.createElement('option');o.value=c;o.textContent=c;cropSelect.appendChild(o);const t=document.createElement('div');t.className='thumb';t.dataset.crop=c;const img=document.createElement('img');img.src=cropImages[cropsSW[i]]||'placeholder.jpg';img.onerror=()=>img.src='placeholder.jpg';t.appendChild(img);t.addEventListener('click',()=>{cropSelect.value=c;document.querySelectorAll('.thumb').forEach(x=>x.classList.remove('selected'));t.classList.add('selected');});thumbs.appendChild(t);});}
populateCrops();
function speakText(text,gender){const u=new SpeechSynthesisUtterance(text);u.lang=currentLang==='en'?'en-US':'sw-TZ';u.pitch=gender==='female'?1.3:gender==='male'?0.85:1;window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}
function showTrend(){const crop=document.getElementById('cropSelect').value;if(!crop){alert('Select crop first');return;}const key=cropsSW[cropsEN.indexOf(crop)]||crop;const d=cropData[key];const ctx=document.getElementById('trendChart').getContext('2d');if(chartInstance)chartInstance.destroy();chartInstance=new Chart(ctx,{type:document.getElementById('chartType').value,data:{labels:monthlyLabels,datasets:[{label:'Rainfall (mm)',data:d.rainfall,yAxisID:'y',borderColor:'#2e8b57',backgroundColor:'#a3e4a3',tension:0.25,pointRadius:0,borderWidth:2},{label:'Temperature (¬∞C)',data:d.temperature,yAxisID:'y1',borderColor:'#ff9933',backgroundColor:'#ffd699',tension:0.25,pointRadius:0,borderWidth:2},{label:'NDVI',data:d.ndvi,yAxisID:'y2',borderColor:'#0066cc',backgroundColor:'#99ccff',tension:0.25,pointRadius:0,borderWidth:2}]},options:{responsive:true,interaction:{mode:'index',intersect:false},stacked:false,scales:{y:{position:'left'},y1:{position:'right',grid:{drawOnChartArea:false}},y2:{display:false}},plugins:{legend:{display:true,position:'top'}}}});}
function showAdvice(){const n=document.getElementById('farmerName').value||'Farmer';const crop=document.getElementById('cropSelect').value;if(!crop){alert('Select crop');return;}const g=document.getElementById('gender').value;const key=cropsSW[cropsEN.indexOf(crop)]||crop;const req=cropData[key].requirements;const schedule={Mahindi:{plant:'March',weed:'May',harvest:'August'},Mpunga:{plant:'May',weed:'July',harvest:'October'},Chai:{plant:'April',weed:'June',harvest:'December'},Kahawa:{plant:'May',weed:'July',harvest:'November'},Maharage:{plant:'March',weed:'April',harvest:'July'},Ufuta:{plant:'March',weed:'May',harvest:'August'}};const s=schedule[key];const txt=`Hello ${n}!\nCrop: ${crop}\nRequirements:${req}\nPlant:${s.plant}\nWeed:${s.weed}\nHarvest:${s.harvest}`;document.getElementById('adviceResult').innerText=txt;speakText(txt,g);}
function populateRegions(){const r=document.getElementById('region');r.innerHTML='<option value="">Select Region</option>';regionsAPI.forEach(x=>{const o=document.createElement('option');o.value=JSON.stringify(x);o.textContent=x.name;r.appendChild(o);});}
populateRegions();
function getSelectedRegionData(){const v=document.getElementById('region').value;return v?JSON.parse(v):null;}
function checkWeather(){const region=getSelectedRegionData();if(!region){alert('Select region');return;}
fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${region.lat}&lon=${region.lng}&units=metric&appid=${apiKey}`).then(r=>r.json()).then(data=>{
const today=data.list[0],tomorrow=data.list[1];const text=`Weather in ${region.name}:\nToday:${today.main.temp}¬∞C,${today.weather[0].description}\nTomorrow:${tomorrow.main.temp}¬∞C,${tomorrow.weather[0].description}`;document.getElementById('adviceResult').innerText=text;speakText(text,'female');
const daily={};data.list.forEach(i=>{const d=new Date(i.dt*1000).toISOString().slice(0,10);if(!daily[d])daily[d]={temps:[],pops:[]};daily[d].temps.push(i.main.temp);daily[d].pops.push(i.pop);});
const all=Object.keys(daily).sort();const next5=all.slice(0,5);const labels=[],avgT=[],avgP=[];next5.forEach(dt=>{avgT.push((daily[dt].temps.reduce((a,b)=>a+b,0)/daily[dt].temps.length).toFixed(1));avgP.push(Math.round((daily[dt].pops.reduce((a,b)=>a+b,0)/daily[dt].pops.length)*100));labels.push(dt);});
const fctx=document.getElementById('forecastChart').getContext('2d');document.getElementById('forecastChart').style.display='block';if(forecastInstance)forecastInstance.destroy();forecastInstance=new Chart(fctx,{type:'line',data:{labels:labels,datasets:[{label:'Avg Temp (¬∞C)',data:avgT,yAxisID:'y',tension:0.3,borderWidth:2},{label:'Rain chance (%)',data:avgP,yAxisID:'y1',type:'bar',barThickness:20}]},options:{responsive:true,scales:{y:{title:{display:true,text:'Temp (¬∞C)'}},y1:{position:'right',title:{display:true,text:'Rain (%)'},grid:{drawOnChartArea:false}}},plugins:{legend:{display:true,position:'top'}}}});});}

// ========== GLOBAL MIC (continuous + animated) ==========
const globalMicBtn=document.getElementById('globalMic');let recognizing=false;let recognition;
if('webkitSpeechRecognition'in window||'SpeechRecognition'in window){const SR=window.SpeechRecognition||window.webkitSpeechRecognition;recognition=new SR();recognition.continuous=true;recognition.interimResults=false;recognition.lang='en-US';
recognition.onresult=function(e){const t=e.results[e.results.length-1][0].transcript.toLowerCase();if(/male|man/.test(t))document.getElementById('gender').value='male';if(/female|woman/.test(t))document.getElementById('gender').value='female';regionsAPI.forEach(r=>{if(t.includes(r.name.toLowerCase()))document.getElementById('region').value=JSON.stringify(r);});cropsEN.forEach((c,i)=>{if(t.includes(c.toLowerCase())||t.includes(cropsSW[i].toLowerCase())){document.getElementById('cropSelect').value=c;}});if(t.includes('trend'))showTrend();if(t.includes('advice'))showAdvice();if(t.includes('weather'))checkWeather();};
recognition.onend=function(){if(recognizing)recognition.start();};
globalMicBtn.addEventListener('click',()=>{if(recognizing){recognizing=false;recognition.stop();globalMicBtn.classList.remove('live');}else{recognition.start();recognizing=true;globalMicBtn.classList.add('live');}});}else{globalMicBtn.style.display='none';}
</script>
</body>
</html>
