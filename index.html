<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Agricultural Advisory System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--red:#e74c3c;--green:#2e8b57;--green-dark:#246b45;}
body{font-family:'Poppins',sans-serif;margin:0;padding:0;background:rgba(200,255,200,0.25);background-image:url('background.jpg');background-size:cover;background-position:center;}
header{text-align:center;background:var(--green);color:#fff;padding:18px 10px;font-size:26px;font-weight:700;position:relative;}
.mic-inline{cursor:pointer;font-size:22px;background:none;border:2px dashed rgba(0,0,0,0.05);padding:8px 12px;border-radius:10px;display:inline-flex;align-items:center;gap:8px;transition:0.2s;}
.mic-inline.live{background:yellow;color:#000;animation:micPulse 1.5s infinite;}
@keyframes micPulse{0%{box-shadow:0 0 0 0 rgba(255,255,0,0.7);}70%{box-shadow:0 0 0 20px rgba(255,255,0,0);}100%{box-shadow:0 0 0 0 rgba(255,255,0,0);}}
.container{max-width:700px;margin:28px auto;background:#ffffffe6;padding:22px;border-radius:14px;box-shadow:0 6px 30px rgba(0,0,0,0.15);}
.profile{display:flex;justify-content:flex-end;align-items:center;gap:14px;}
.profile img{width:150px;height:150px;border-radius:50%;object-fit:cover;border:4px solid var(--red);}
.profile .subtitle{text-align:center;font-size:13px;color:#333;line-height:1.1;white-space:pre-line;}
form .row{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;}
.left,.right{flex:1 1 320px;min-width:280px;}
label{display:block;margin-top:8px;font-weight:600;color:#222;}
input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc;font-size:15px;}
button{background:var(--red);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;}
button:hover{background:#c0392b;}
button.vertical{flex-direction:column;padding:12px;font-size:16px;}
#adviceResult{margin-top:16px;padding:15px;border-radius:10px;background: rgba(255,255,255,0.9); font-weight:600;color:#000;white-space:pre-line;}
canvas{margin-top:20px;width:100% !important;height:400px !important;}
.crop-thumbs{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
.thumb{width:90px;height:70px;border-radius:8px;overflow:hidden;border:2px solid transparent;cursor:pointer;text-align:center;display:flex;align-items:center;justify-content:center;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;}
.thumb.selected{border-color:var(--red);box-shadow:0 4px 14px rgba(231,76,60,0.3);}
.lang-area{text-align:center;margin-top:8px;}
.meta-small{font-size:13px;color:#555;margin-top:6px;}
@media(max-width:720px){.left,.right{min-width:100%;}.crop-thumbs{justify-content:flex-start;}}
.fade-in{animation:fadeIn 0.8s ease-in-out;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
#forecastChart{height:260px !important;}
</style>
</head>
<body>
<header id="siteHeader">
  Agricultural Advisory System
  <div class="lang-area" style="margin-top:8px;">
    <button id="langToggle">üåê Change Language / Badilisha Lugha</button>
  </div>
</header>

<div class="container">
  <div class="profile">
    <div><img id="profileImg" src="profile.jpg" alt="Profile"></div>
    <div class="subtitle">
Created by
Name:Taisoni Ambokile Mwaluswaswa
Phone No:0749458547
Proffessionalism:GIS and RS Expert
Gmail:taisonimwuluswaswa@gmail.com
    </div>
  </div>

  <form id="mainForm" onsubmit="return false;">
    <div class="row">
      <div class="left">
        <div style="display:flex; gap:10px; align-items:center; justify-content:flex-start; margin-bottom:8px;">
          <button id="globalMic" type="button" class="mic-inline" title="Start Speaking">üé§ <span id="micLabel">Start Speaking</span></button>
        </div>

        <label id="lblName">Full Name:</label>
        <input id="farmerName" type="text" placeholder="Enter your name" />
        <label id="lblGender">Gender:</label>
        <select id="gender">
          <option value="">Select Gender</option>
          <option value="male">üßëüèæ Male</option>
          <option value="female">üßïüèæ Female</option>
          <option value="other">‚öß Other</option>
        </select>
        <label id="lblRegion">Region:</label>
        <select id="region"></select>
        <label id="lblCrop">Crop:</label>
        <select id="cropSelect"></select>
        <div class="crop-thumbs" id="cropThumbs"></div>
        <div class="meta-small" id="tipText">Tip: you may click thumbnail to choose crop.</div>
        <label id="lblChartType">Chart Type:</label>
        <select id="chartType">
          <option value="line">Line (monthly)</option>
          <option value="bar">Bar</option>
        </select>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:12px;">
          <button type="button" class="vertical" id="trendBtn">üìä Show Trend</button>
          <button type="button" class="vertical" id="adviceBtn">üí¨ Show Advice</button>
          <button type="button" class="vertical" id="weatherBtn">üå¶Ô∏è Check Weather</button>
        </div>
        <div id="adviceResult" aria-live="polite"></div>
      </div>

      <div class="right">
        <canvas id="trendChart"></canvas>
        <canvas id="forecastChart"></canvas>
      </div>
    </div>
  </form>
</div>

<script>
// ======= Data and translations =======
let currentLang='en';
let chartInstance=null;
let forecastInstance=null;

const cropsEN=["Corn","Rice","Tea","Coffee","Beans","Potatoes","Cassava"];
const cropsSW=["Mahindi","Mpunga","Chai","Kahawa","Maharage","Viazi","Ufuta"];
const cropImages={Mahindi:"mahindi.jpg",Mpunga:"mpunga.jpg",Chai:"chai.jpg",Kahawa:"kahawa.jpg",Maharage:"maharage.jpg",Viazi:"viazi.jpg",Ufuta:"ufuta.jpg"};
const regionsAPI=[{name:"Songwe",lat:-9.258,lng:33.642},{name:"Mbeya",lat:-8.91,lng:33.45},{name:"Iringa",lat:-7.771,lng:35.685},{name:"Dodoma",lat:-6.163,lng:35.751},{name:"Morogoro",lat:-6.827,lng:37.659},{name:"Kilimanjaro",lat:-3.067,lng:37.355},{name:"Mwanza",lat:-2.516,lng:32.9},{name:"Arusha",lat:-3.386,lng:36.68},{name:"Tanga",lat:-5.07,lng:39.1},{name:"Ruvuma",lat:-10.634,lng:35.616},{name:"Dar es Salaam",lat:-6.7924,lng:39.2083},{name:"Tunduma",lat:-9.3,lng:32.8}];

const translations={
en:{lblName:"Full Name:",lblGender:"Gender:",lblRegion:"Region:",lblCrop:"Crop:",lblChartType:"Chart Type:",tipText:"Tip: you may click thumbnail to choose crop.",trendBtn:"üìä Show Trend",adviceBtn:"üí¨ Show Advice",weatherBtn:"üå¶Ô∏è Check Weather",gender:['','üßëüèæ Male','üßïüèæ Female','‚öß Other'],advice:{Mahindi:"Needs 500‚Äì800mm rainfall and 18‚Äì27¬∞C.",Mpunga:"Needs 1000‚Äì2000mm rainfall and >25¬∞C.",Chai:"Prefers 1200‚Äì2500mm rainfall and 16‚Äì25¬∞C.",Kahawa:"Needs 1000‚Äì2000mm rainfall and 18‚Äì26¬∞C.",Maharage:"Moderate 600‚Äì1200mm and 18‚Äì28¬∞C.",Ufuta:"Needs 600‚Äì900mm and 18‚Äì26¬∞C."}},
sw:{lblName:"Jina Kamili:",lblGender:"Jinsia:",lblRegion:"Mkoa:",lblCrop:"Zao:",lblChartType:"Aina ya Chati:",tipText:"Kumbuka: Bonyeza thumbnail kuchagua zao.",trendBtn:"üìä Onyesha Mchoro",adviceBtn:"üí¨ Onyesha Ushauri",weatherBtn:"üå¶Ô∏è Angalia Hali ya Hewa",gender:['','üßëüèæ Mwanaume','üßïüèæ Mwanamke','‚öß Kwingine'],advice:{Mahindi:"Inahitaji mvua 500‚Äì800mm na joto 18‚Äì27¬∞C.",Mpunga:"Inahitaji mvua 1000‚Äì2000mm na >25¬∞C.",Chai:"Inapendelea mvua 1200‚Äì2500mm na joto 16‚Äì25¬∞C.",Kahawa:"Inahitaji mvua 1000‚Äì2000mm na joto 18‚Äì26¬∞C.",Maharage:"Kati ya 600‚Äì1200mm na 18‚Äì28¬∞C.",Ufuta:"Inahitaji mvua 600‚Äì900mm na joto 18‚Äì26¬∞C."}}
};

// ======= Populate functions =======
function populateRegions(){
  const r=document.getElementById('region');
  r.innerHTML='<option value="">'+(currentLang==='en'?'Select Region':'Chagua Mkoa')+'</option>';
  regionsAPI.forEach(x=>{
    const o=document.createElement('option');
    o.value=JSON.stringify(x);
    o.textContent=x.name;
    r.appendChild(o);
  });
}

function populateCrops(){
  const cropSelect=document.getElementById('cropSelect');
  const thumbs=document.getElementById('cropThumbs');
  cropSelect.innerHTML=""; thumbs.innerHTML="";
  const list=currentLang==='en'?cropsEN:cropsSW;
  list.forEach((c,i)=>{
    const o=document.createElement('option'); o.value=c; o.textContent=c; cropSelect.appendChild(o);
    const t=document.createElement('div'); t.className='thumb'; t.dataset.crop=c;
    const img=document.createElement('img'); img.src=cropImages[cropsSW[i]]||'placeholder.jpg';
    img.onerror=()=>img.src='placeholder.jpg'; t.appendChild(img);
    t.addEventListener('click',()=>{cropSelect.value=c;document.querySelectorAll('.thumb').forEach(x=>x.classList.remove('selected'));t.classList.add('selected');});
    thumbs.appendChild(t);
  });
}

// ======= Set language =======
function setLanguage(lang){
  currentLang=lang;
  document.getElementById('lblName').textContent=translations[lang].lblName;
  document.getElementById('lblGender').textContent=translations[lang].lblGender;
  const gsel=document.getElementById('gender');
  gsel.options[1].text=translations[lang].gender[1];
  gsel.options[2].text=translations[lang].gender[2];
  gsel.options[3].text=translations[lang].gender[3];
  document.getElementById('lblRegion').textContent=translations[lang].lblRegion;
  document.getElementById('lblCrop').textContent=translations[lang].lblCrop;
  document.getElementById('lblChartType').textContent=translations[lang].lblChartType;
  document.getElementById('tipText').textContent=translations[lang].tipText;
  document.getElementById('trendBtn').textContent=translations[lang].trendBtn;
  document.getElementById('adviceBtn').textContent=translations[lang].adviceBtn;
  document.getElementById('weatherBtn').textContent=translations[lang].weatherBtn;
  populateRegions(); populateCrops();
}

setLanguage('en');

// ======= Speak =======
function speakText(text,gender){
  const u=new SpeechSynthesisUtterance(text);
  u.lang=currentLang==='en'?'en-US':'sw-TZ';
  u.pitch=(gender==='female'||gender==='mwanamke')?1.3:(gender==='male'||gender==='mwanaume')?0.85:1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

// ======= Advice =======
function showAdvice(){
  const crop=document.getElementById('cropSelect').value;
  if(!crop){alert(currentLang==='en'?'Select crop':'Chagua zao'); return;}
  const gender=document.getElementById('gender').value||'other';
  const key=cropsSW[cropsEN.indexOf(crop)]||crop;
  const advice=translations[currentLang].advice[key];
  document.getElementById('adviceResult').textContent=advice;
  speakText(advice,gender);
}

// ======= Trend =======
function showTrend(){
  const crop=document.getElementById('cropSelect').value;
  if(!crop){alert(currentLang==='en'?'Select crop':'Chagua zao'); return;}
  const ctx=document.getElementById('trendChart').getContext('2d');
  if(chartInstance)chartInstance.destroy();
  chartInstance=new Chart(ctx,{
    type:document.getElementById('chartType').value,
    data:{
      labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
      datasets:[
        {label:'Rainfall (mm)',data:[90,95,100,110,120,115,105,95,100,110,90,85],borderColor:'#000',backgroundColor:'#00000033',tension:0.25,pointRadius:3,borderWidth:2},
        {label:'Temperature (¬∞C)',data:[22,23,21,24,22,23,21,22,23,24,22,21],borderColor:'#000',backgroundColor:'#00000033',tension:0.25,pointRadius:3,borderWidth:2}
      ]
    },
    options:{responsive:true,plugins:{legend:{labels:{color:'#000'}}},scales:{x:{ticks:{color:'#000'}},y:{ticks:{color:'#000'}}}}
  });
}

// ======= Forecast =======
function checkWeather(){
  const ctx=document.getElementById('forecastChart'); ctx.style.display='block';
  const labels=['Day1','Day2','Day3','Day4','Day5'];
  const temps=[21,23,22,24,23]; const rains=[10,5,12,0,8];
  if(forecastInstance)forecastInstance.destroy();
  forecastInstance=new Chart(ctx,{
    type:'line',
    data:{labels:labels,datasets:[{label:'Temperature ¬∞C',data:temps,borderColor:'#000',backgroundColor:'#00000033',tension:0.3,fill:true},{label:'Rainfall mm',data:rains,borderColor:'#000',backgroundColor:'#00000033',tension:0.3,fill:true}]},
    options:{responsive:true,plugins:{legend:{display:true,labels:{color:'#000'}}},scales:{x:{ticks:{color:'#000'}},y:{ticks:{color:'#000'}}}}
  });
}

// ======= Buttons =======
document.getElementById('trendBtn').addEventListener('click',showTrend);
document.getElementById('adviceBtn').addEventListener('click',showAdvice);
document.getElementById('weatherBtn').addEventListener('click',checkWeather);
document.getElementById('langToggle').addEventListener('click',()=>{setLanguage(currentLang==='en'?'sw':'en');});

// ======= GLOBAL MIC =======
const globalMicBtn=document.getElementById('globalMic');
let recognizing=false; let recognition;

if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  recognition=new SR();
  recognition.continuous=true;
  recognition.interimResults=false;
  recognition.lang='en-US';

  recognition.onresult=function(e){
    const t=e.results[e.results.length-1][0].transcript.toLowerCase();
    const nameInput=document.getElementById('farmerName');
    const genderSelect=document.getElementById('gender');
    const regionSelect=document.getElementById('region');
    const cropSelect=document.getElementById('cropSelect');

    // Detect gender
    if(/male|man|mwanaume/.test(t)) genderSelect.value='male';
    if(/female|woman|mwanamke/.test(t)) genderSelect.value='female';

    // Detect region
    regionsAPI.forEach(r=>{
      if(t.includes(r.name.toLowerCase())) regionSelect.value=JSON.stringify(r);
    });

    // Detect crop
    cropsEN.forEach((c,i)=>{
      if(t.includes(c.toLowerCase())||t.includes(cropsSW[i].toLowerCase())){
        cropSelect.value=c;
      }
    });

    // Detect name (assume first words before crop or gender)
    const words=t.split(' ');
    if(words.length>0) nameInput.value=words.slice(0,2).join(' ');

    // Commands
    if(t.includes('trend')||t.includes('mchoro')) showTrend();
    if(t.includes('advice')||t.includes('ushauri')) showAdvice();
    if(t.includes('weather')||t.includes('hali ya hewa')) checkWeather();
  };

  recognition.onend=function(){ if(recognizing) recognition.start(); };
  globalMicBtn.addEventListener('click',()=>{
    if(recognizing){recognizing=false;recognition.stop();globalMicBtn.classList.remove('live');document.getElementById('micLabel').textContent=currentLang==='en'?'Start Speaking':'Anza Kuzungumza';}
    else{recognizing=true;recognition.start();globalMicBtn.classList.add('live');document.getElementById('micLabel').textContent=currentLang==='en'?'Listening...':'Kinasikiliza...';}
  });
}else{globalMicBtn.style.display='none';}
</script>
</body>
</html>
